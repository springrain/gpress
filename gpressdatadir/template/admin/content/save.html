{{template "admin/header.html"}}
<title>save - GPRESS</title>
{{template "admin/bodystart.html"}}
{{ $tableFiled := tableFiled .urlPathParam }}
{{$analyzer := analyzer}}
{{$fieldType := fieldType}}

<section class="section">
	<div class="container">
		<div class="table-content">
			<!-- is-6-desktop is-6-tablet -->
			<div class="column">
				<form id="gpress-form" action="{{basePath}}admin/{{.urlPathParam}}/save" method="POST">
					{{ $data := . }}
					{{ range $tableFiled }}
					{{ if ne .FieldCode "id" }}

					<div class="field is-horizontal flex-center">
						<div class="field-left" style="width: 150px;">
							<label class="label">{{.FieldName}}</label>
							<input type="hidden" id="fieldType_{{.FieldCode}}" value="{{.FieldType}}" />
						</div>
						<div class="field-right" style="width: 340px;">
							<div class="field">
								<div class="control">
									{{if eq .FieldCode "fieldType"}}
									<select name="{{.FieldCode}}" class="input">
										{{ range $key,$value := $fieldType }}
										<option value={{$key}}>{{$value}}</option>
										{{end}}
									</select>
									{{else if eq .FieldCode "analyzerName"}}
										<select name="{{.FieldCode}}" class="input">
											{{ range $key,$value := $analyzer }}
											<option value={{$key}}>{{$value}} </option>
											{{end}}
										</select>
										{{else }}
											<input class="input" type="text" name="{{.FieldCode}}" id="{{.FieldCode}}">
											{{end}}
								</div>
							</div>
						</div>
					</div>
					{{end}}
					{{end}}
					<div id="editor—wrapper">
						<div id="toolbar-container">
							<!-- 工具栏 -->
						</div>
						<div id="editor-container">
							<!-- 编辑器 -->
						</div>
					</div>
					<div id="editor">

					</div>

					<div class="field is-grouped" style="padding-left: 110px;">
						<div class="control">
							<button type="submit" class="button is-primary">提交</button>
						</div>
						<div class="control">
							<button type="reset" class="button is-info is-light">重置</button>
						</div>
					</div>
				</form>
			</div>
		</div>
	</div>
</section>

<link href="https://cdn.staticfile.org/wangeditor5/5.1.23/css/style.min.css" rel="stylesheet">
<script src="https://cdn.staticfile.org/wangeditor5/5.1.23/index.min.js"></script>
<script>
	const form = document.querySelector('#gpress-form')
	const {
		createEditor,
		createToolbar
	} = window.wangEditor

	const editorConfig = {
		placeholder: '请输入内容...',
		onChange(editor) {
			const html = editor.getHtml()
			console.log('editor content', html)
			// 也可以同步到 <textarea>
		}
	}

	const editor = createEditor({
		selector: '#editor-container',
		html: '<p></p>',
		config: editorConfig,
		mode: 'default', // or 'simple'
	})

	const toolbarConfig = {}

	const toolbar = createToolbar({
		editor,
		selector: '#toolbar-container',
		config: toolbarConfig,
		mode: 'default', // or 'simple'
	})


	form.addEventListener('submit', async event => {
		event.preventDefault()
		const formData = new FormData(form)
		const jsonObject = {}
		for (const [key, value] of formData.entries()) {
			const fieldType = document.querySelector('#fieldType_' + key).value
			if (!!fieldType && fieldType == 1) {
				jsonObject[key] = parseInt(value)
			}
			//if (key == "sortNo" ||key == "status"||key == "fieldType"||key == "required"){
			//  jsonObject[key] = parseInt(value);
			//}
			else {
				jsonObject[key] = value
			}
		}
		console.log(jsonObject)
		const response = await fetch(form.action, {
			method: form.method,
			body: JSON.stringify(jsonObject),
			headers: { 'Content-Type': 'application/json' }
		})
		let res = await response.json()
		if (res.statusCode == 200) {
			$.confirm({
				useBootstrap: false,
				boxWidth: '400px',
				title: '提示',
				content: '保存成功！',
				type: 'green',
				buttons: {
					'确定': function() {
						window.location.href = '{{basePath}}admin/{{.urlPathParam}}/list'
					}
				}
			})
		}
	})
</script>


{{template "admin/bodyend.html"}}
